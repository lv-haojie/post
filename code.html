<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>邮储银行柜面业务OCR识别</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <style>
        /* 自定义样式 */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        #camera-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #video-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* 水平翻转，像镜子一样 */
        }
        
        #scan-frame {
            position: absolute;
            top: 50%;
            left: 10%;
            width: 80%;
            height: 60px;
            margin-top: -30px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            background-color: rgba(76, 175, 80, 0.1);
            z-index: 10;
        }
        
        #scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #4CAF50;
            animation: scan 2s linear infinite;
            z-index: 11;
        }
        
        #result-container {
            position: absolute;
            bottom: 20px;
            left: 10%;
            width: 80%;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            color: white;
            z-index: 20;
            text-align: center;
        }
        
        #business-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #4CAF50;
        }
        
        #business-code {
            font-size: 16px;
            color: #E0F2F1;
        }
        
        #status-info {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 8px 0;
            font-size: 14px;
            z-index: 20;
        }
        
        @keyframes scan {
            0% { top: 0; }
            50% { top: calc(100% - 3px); }
            100% { top: 0; }
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="camera-container">
        <!-- 摄像头预览 -->
        <video id="video-preview" autoplay playsinline muted></video>
        
        <!-- 识别框 -->
        <div id="scan-frame">
            <div id="scan-line"></div>
        </div>
        
        <!-- 状态信息 -->
        <div id="status-info">
            <span id="status-text">初始化中...</span>
            <div id="loading" class="loading-spinner"></div>
        </div>
        
        <!-- 结果显示区域 -->
        <div id="result-container">
            <div id="business-name">等待识别...</div>
            <div id="business-code">业务编号将在此显示</div>
        </div>
    </div>

    <script>
        // 业务数据（预加载）
        const businessData = {
  "柜员强制签退": "10103",
  "柜员密码修改": "10201",
  "柜员签到/签退登记簿查询": "19003",
  "柜员交易流水查询": "19005",
  "授权查询": "19008",
  "机构签退": "20102",
  "机构信息查询及维护": "20205",
  "网点信息查询": "29001",
  "摘要信息查询": "40207",
  "凭证补打": "50101",
  "ITM稽核补拍": "50105",
  "联网核查": "50108",
  "自动化用印-手工用印登记": "50202",
  "线下手工用印登记-线下手工用印申请": "50210",
  "自动化用印-人工授权用印申请": "50298",
  "记账参数信息查询": "60114",
  "智能箱包信息查询": "60126",
  "机构交易量统计信息查询": "60127",
  "交易取消记录信息查询": "60128",
  "网点待处理任务查询": "60129",
  "网点箱包历史流转记录查询": "60130",
  "网点作业时间维护": "60131",
  "尾箱维护": "60201",
  "尾箱领用": "60202",
  "尾箱上缴": "60203",
  "尾箱维护查询": "60204",
  "柜员轧账": "60205",
  "机构轧账": "60206",
  "强行轧账查询": "60207",
  "尾箱查询": "60209",
  "缴拨调剂查询": "60210",
  "单据补打/查询": "60211",
  "机构轧账寄库装箱": "60215",
  "柜员尾箱现金余额尾数查询": "60216",
  "柜员领用/上缴现金": "60301",
  "网点拨款请求/取消": "60302",
  "网点收到现金": "60303",
  "网点缴款": "60304",
  "现金特殊需求预约/查询": "60307",
  "现金特殊需求预约修改（核实）/核销": "60308",
  "残损币兑换": "60309",
  "网点库存余额结构维护": "60310",
  "网点长短款事项": "60311",
  "网点长短款登记簿": "60313",
  "网点假币收缴录入/修改/删除": "60321",
  "网点假币收缴复核": "60322",
  "网点假币收缴记录查询": "60323",
  "假币代保管登记簿": "60327",
  "假币库存明细登记簿查询": "60328",
  "网点联机冲正、差错调整长短款查询": "60379",
  "网点收到汇兑缴款": "60381",
  "网点下拨汇兑款": "60383",
  "柜员现金调剂": "60385",
  "网点上缴装箱": "60387",
  "柜员领/缴重要单证": "60401",
  "网点重要单证请领/取消": "60402",
  "网点收到重要单证": "60403",
  "网点上缴重要单证": "60404",
  "重要单证作废": "60407",
  "重要单证登记簿查询": "60409",
  "柜员重要单证调剂": "60410",
  "移动展业尾箱查询": "60502",
  "移动展业收到上缴重要单证": "60503",
  "移动展业柜员轧账": "60505",
  "自助银行尾箱轧账": "60601",
  "自助银行尾箱查询": "60603",
  "自助设备现金领用/上缴": "60604",
  "自助设备重要单证领缴": "60607",
  "自助银行重要单证登记簿查询": "60612",
  "自助银行长短款事项": "60614",
  "自助银行长短款登记簿": "60615",
  "自助设备长款转账付出取消": "60616",
  "自助设备加钞记录查询": "60617",
  "自助银行余额查询": "60618",
  "网点纪念币核查结果查询/解锁": "60802",
  "纪念币预约/兑换信息查询": "60804",
  "纪念币库存登记薄查询": "60807",
  "全部导出查询下载": "60901",
  "名单数据查询": "70202",
  "反诈名单查询": "70203",
  "客户信息录入/修改": "110101",
  "客户信息管理": "110102",
  "客户信息查询": "110104",
  "客户风险评估": "110106",
  "强化尽职调查": "110107",
  "修改户名/证件登记簿查询": "110109",
  "客户信息待核实标识取消": "110112",
  "手机号码统一视图管理": "110113",
  "客户三要素修改": "110116",
  "手工同步信息": "110190",
  "一键绑卡": "110202",
  "查询引荐营销线索": "110302",
  "快签手活动": "110303",
  "综合开户": "210101",
  "行内存款": "210102",
  "行内取款": "210103",
  "介质迁移": "210104",
  "综合销户": "210105",
  "柜面他行卡取款": "210106",
  "绿卡通一本通定活互转": "210107",
  "个人大额存单开户": "210109",
  "个人大额存单子账户支取/销户": "210110",
  "大额存单产品信息查询": "210112",
  "一键签约": "210124",
  "一键解约": "210125",
  "一键平移": "210126",
  "一键查询": "210127",
  "新市民认证": "210128",
  "一键修改": "210130",
  "同步加办关系": "210133",
  "定期转定期": "210134",
  "综合销户（试点）": "210136",
  "账户激活": "210137",
  "行业应用子账户查询": "210202",
  "密码重置": "210305",
  "挂失及后续处理": "210309",
  "社保卡医保账户解挂失": "210310",
  "社保卡医保账户密码重置": "210311",
  "社保卡医保账户更改密印": "210312",
  "止付": "210401",
  "解止付": "210402",
  "冻结/解冻结": "210403",
  "扣划（司法）": "210406",
  "可疑凭证解锁定": "210409",
  "手工事项取款/销户": "210410",
  "开立定期存单质押业务证明书（存单止付）": "210412",
  "撤销定期存单质押业务证明书（存单解止付）": "210413",
  "来账状态查询": "210427",
  "免费账户查询": "210433",
  "代理人代理开户信息查询": "210438",
  "非实时转账撤销": "210439",
  "账户限制非柜面交易": "210450",
  "冲正": "210601",
  "取消": "210602",
  "现金汇款公司账户交易取消": "210632",
  "补登折/对账簿": "210701",
  "打印压缩明细": "210702",
  "随机换/折/单": "210705",
  "重新写磁": "210706",
  "加办密印": "210801",
  "更改密印": "210802",
  "撤销密印": "210803",
  "开立个人存款证明": "210901",
  "撤销个人存款证明": "210902",
  "个人存款证明登记簿查询和补打印": "210904",
  "账户升级/降级": "211001",
  "账户绑定关系设置": "211002",
  "I类账户批量降级": "211003",
  "账户绑定关系查询": "211005",
  "II类账户消费/缴费限额修改": "211006",
  "无介质II/III类账户身份确认": "211007",
  "账户加办关系查询与强制撤销": "211011",
  "强制销户": "211102",
  "非柜面限制交易解除": "211103",
  "一人多账户合理性原因登记": "211104",
  "多账户/多客户核实情况查询": "211105",
  "借记卡安全锁设置": "211107",
  "账户停用": "211108",
  "账户非柜面支付限额设置": "211109",
  "账户非柜面限额调整历史记录查询": "211114",
  "账户快捷支付限额设置": "211120",
  "自助交易设置": "211201",
  "自助设备可疑交易查询": "211207",
  "批量开定制卡": "211303",
  "批量处理结果查询": "211309",
  "批量开户未领介质对应关系查询": "211312",
  "批量开户": "211316",
  "批量文件编辑工具": "211317",
  "批量联网核查": "211318",
  "批量领介质": "211323",
  "可疑名单录入/删除": "211401",
  "可疑名单查询": "211404",
  "交易拦截查询功能": "211405",
  "开立个人养老金账户": "211501",
  "养老金账户缴存": "211502",
  "养老金账户支取": "211503",
  "养老金账户转移申请": "211505",
  "养老金账户转移取消": "211506",
  "养老金账户转移处理": "211507",
  "税延凭证打印": "211508",
  "养老金账户注销": "211509",
  "养老金账户激活/密码重置": "211510",
  "养老金账户缴存撤回": "211512",
  "账户风险等级人工评定": "211601",
  "账户回访任务处理": "211605",
  "存续期账户识别待办任务处理": "211607",
  "账户存续期识别情况统计表": "211609",
  "账户回访情况统计表": "211610",
  "个人账户评级白名单维护": "211611",
  "根据账号查短信加办关系": "212006",
  "交易日流水查询": "212007",
  "账户变动通知退费": "212011",
  "根据账号查账户变动通知历史变更记录": "212012",
  "开销户登记簿查询": "219001",
  "客户资料变更登记薄查询": "219002",
  "挂失登记簿查询": "219003",
  "司法止付/冻结登记簿": "219004",
  "止付解止付登记簿查询": "219005",
  "柜员差错交易登记簿查询": "219006",
  "同号换（补）卡登记簿查询": "219008",
  "扣划登记簿查询": "219009",
  "账户限制服务登记簿查询": "219016",
  "账户升降级登记簿查询": "219018",
  "客户业务办理情况查询": "219101",
  "新旧账（卡）号及归属地查询": "219102",
  "账务类交易流水查询": "219104",
  "根据账号/卡号查询非账务明细": "219106",
  "非账务类交易流水查询": "219107",
  "柜员末笔账务类交易查询": "219108",
  "报表查询打印": "219109",
  "收欠费明细查询": "219110",
  "柜员交易日志查询": "219111",
  "客户账户信息查询": "219114",
  "非实时转账查询": "219115",
  "电子现金账户明细查询": "219205",
  "查询账户基本信息": "219206",
  "查询账户明细": "219208",
  "系统退费明细查询": "219210",
  "定期账户转存明细查询": "219212",
  "跨境POS消费日累计系统限额查询": "219213",
  "副卡信息查询（客户、内部）": "219217",
  "副卡明细查询（客户、内部）": "219218",
  "人行小额支付系统代收付业务交易信息查询": "219219",
  "已故客户信息及明细信息": "219224",
  "一键账户查询": "219225",
  "司法查询": "219305",
  "批量司法查询结果下载": "219308",
  "电子现金卡退卡": "220111",
  "圈提": "220118",
  "同号换卡": "220201",
  "主卡撤销副卡": "220203",
  "副卡启用/停用": "220204",
  "换卡": "220208",
  "同号换（补）卡申请": "220209",
  "同号补卡": "220210",
  "同号/定制卡号凭证作废": "220211",
  "撤销折/对账簿": "220212",
  "卡撤销": "220213",
  "卡加办补发对账簿": "220214",
  "柜面他行卡查询": "220216",
  "吞没卡/废卡登记": "220301",
  "吞没卡/废卡领取": "220302",
  "吞没卡/废卡查询": "220303",
  "吞没卡/废卡上缴": "220304",
  "吞没卡/废卡上缴清单打印": "220305",
  "吞没卡/废卡登记簿查询": "220306",
  "绿卡通卡内约定转账定制": "220601",
  "绿卡通约定转账变更/撤销/查询": "220602",
  "电子银行账户强制撤销": "230101",
  "电子银行客户查询": "230103",
  "电子银行渠道关闭": "230104",
  "电子银行账户撤销": "230201",
  "电子银行认证工具变更": "230301",
  "电子银行认证工具换发": "230302",
  "电子银行UK证书补发": "230303",
  "电子银行密码重置": "230401",
  "手机银行设备绑定码申请": "230407",
  "电子银行信息同步/强制解约": "230409",
  "银联无卡支付签约信息查询": "230501",
  "钱包开立": "250101",
  "个人钱包销户": "250103",
  "数字货币兑回": "250107",
  "钱包基本信息查询": "250119",
  "钱包信息司法查询": "250301",
  "钱包交易明细司法查询": "250302",
  "钱包紧急止付解除": "250305",
  "钱包司法冻结": "250307",
  "汇款": "310101",
  "现金汇款公司账户": "310103",
  "预约账户汇款申请": "310120",
  "预约账户汇款修改/撤销": "310121",
  "预约账户汇款查询": "310122",
  "退汇挂账核销": "310130",
  "跨行汇款登记簿": "310190",
  "大小额往账交易明细查询": "310191",
  "跨行资金归集协议签约": "310201",
  "手机号收款账户管理": "310302",
  "按址取款通知单打印记录查询": "360101",
  "按址汇款短信发送查询/重发": "360103",
  "按址汇款": "360104",
  "密码汇款": "360105",
  "向商户号转账汇款": "360106",
  "汇票兑付": "360107",
  "通知单连续打印": "360108",
  "通知单补打": "360109",
  "投递清单浏览/打印": "360110",
  "汇兑凭证补打": "360111",
  "商户余额查询": "360201",
  "商务汇款清单查询": "360206",
  "收到商户资金": "360210",
  "商户收汇收据开发": "360211",
  "置妥前信息确认": "360214",
  "收据置妥": "360215",
  "汇票止付": "360301",
  "汇票详细信息查询": "360304",
  "接收专号查询": "360305",
  "特殊业务登记薄": "360308",
  "改汇": "360309",
  "取款通知单挂失": "360310",
  "撤销取款通知单挂失": "360311",
  "邮政汇兑短信服务": "360312",
  "客户申请退汇": "360314",
  "无法兑付退汇": "360315",
  "密码汇款密码挂失": "360316",
  "邮政汇兑密码重置": "360317",
  "收汇信息/附加业务更正": "360403",
  "汇款取消": "360404",
  "汇兑机构查询": "360701",
  "汇兑末笔流水查询": "360703",
  "信用卡现金存款": "410101",
  "信用卡现金转账还款": "410102",
  "信用卡账户转账还款": "410103",
  "信用卡取现": "410104",
  "信用卡转出转账": "410105",
  "信用卡账户余额查询": "410201",
  "信用卡账单头查询": "410202",
  "信用卡自动还款加办关系查询": "410203",
  "信用卡卡列表查询": "410204",
  "信用卡卡详细信息查询": "410205",
  "信用卡手机号码修改": "410301",
  "信用卡自动还款加办撤销": "410303",
  "信用卡激活": "410305",
  "信用卡交易密码重置": "410308",
  "信用卡小额免密免签功能设置": "410310",
  "新保承保": "610001",
  "我的投保单": "610002",
  "我的双录": "610003",
  "联机非实时保单录入": "610071",
  "联机非实时保单修改及取消": "610072",
  "保单信息查询": "610073",
  "代收业务三方协议管理": "610076",
  "交易代码查询": "610122",
  "理财类业务签约": "620101",
  "资金账号追加": "620102",
  "个人投资者客户资料查询": "620105",
  "个人合格投资者认定": "620108",
  "资金账号变更": "620109",
  "资金账号与身份证不一致变更": "620114",
  "特殊资金账号加办": "620115",
  "登记簿查询": "620117",
  "财产证明联动查询": "620123",
  "营业参数下载": "620126",
  "资产归并": "620128",
  "交易流水查询": "620129",
  "历史交易明细查询": "620130",
  "报表下载": "620131",
  "手续费参数查询": "620134",
  "理财类异常签约客户查询": "620141",
  "基金赎回": "620202",
  "网点代理基金品种查询": "620265",
  "理财产品购买（个人）": "620303",
  "理财产品赎回（个人）": "620305",
  "储蓄国债（凭证式）提前兑取（新）": "620402",
  "凭证国债取消购买交易": "620404",
  "凭证式国债出单": "620405",
  "凭证式国债收单": "620406",
  "储蓄国债（凭证式）挂失": "620420",
  "储蓄国债（凭证式）挂失补发": "620422",
  "储蓄国债(电子式)提前兑付": "620504",
  "个人当日/次日预约提金信息查询": "630611",
  "变更银行结算账号（个人）": "640203",
  "存管客户解约（个人）": "640204",
  "个人用户签约": "710101",
  "个人用户签约查询": "710102",
  "个人用户签约修改": "710104",
  "个人用户解约": "710105",
  "缴费": "710201",
  "发票/收据补打": "710206",
  "入账资金明细查询": "710213",
  "入账资金确认": "710214",
  "交易对手信息查询": "710305",
  "委托方签约信息查询": "710402",
  "优待证补换卡信息登记": "710927",
  "山东社保卡维护交易": "710938",
  "通用委托方信息查询": "720302",
  "业主开户": "720801",
  "文件加密密码申请": "730119",
  "缴费结果查询": "770302",
  "待查补录类": "770303",
  "任务汇总查询": "990105"
};
        const businessNames = ["柜员强制签退", "柜员密码修改", "柜员签到/签退登记簿查询", "柜员交易流水查询", "授权查询", "机构签退", "机构信息查询及维护", "网点信息查询", "摘要信息查询", "凭证补打", "ITM稽核补拍", "联网核查", "自动化用印-手工用印登记", "线下手工用印登记-线下手工用印申请", "自动化用印-人工授权用印申请", "记账参数信息查询", "智能箱包信息查询", "机构交易量统计信息查询", "交易取消记录信息查询", "网点待处理任务查询", "网点箱包历史流转记录查询", "网点作业时间维护", "尾箱维护", "尾箱领用", "尾箱上缴", "尾箱维护查询", "柜员轧账", "机构轧账", "强行轧账查询", "尾箱查询", "缴拨调剂查询", "单据补打/查询", "机构轧账寄库装箱", "柜员尾箱现金余额尾数查询", "柜员领用/上缴现金", "网点拨款请求/取消", "网点收到现金", "网点缴款", "现金特殊需求预约/查询", "现金特殊需求预约修改（核实）/核销", "残损币兑换", "网点库存余额结构维护", "网点长短款事项", "网点长短款登记簿", "网点假币收缴录入/修改/删除", "网点假币收缴复核", "网点假币收缴记录查询", "假币代保管登记簿", "假币库存明细登记簿查询", "网点联机冲正、差错调整长短款查询", "网点收到汇兑缴款", "网点下拨汇兑款", "柜员现金调剂", "网点上缴装箱", "柜员领/缴重要单证", "网点重要单证请领/取消", "网点收到重要单证", "网点上缴重要单证", "重要单证作废", "重要单证登记簿查询", "柜员重要单证调剂", "移动展业尾箱查询", "移动展业收到上缴重要单证", "移动展业柜员轧账", "自助银行尾箱轧账", "自助银行尾箱查询", "自助设备现金领用/上缴", "自助设备重要单证领缴", "自助银行重要单证登记簿查询", "自助银行长短款事项", "自助银行长短款登记簿", "自助设备长款转账付出取消", "自助设备加钞记录查询", "自助银行余额查询", "网点纪念币核查结果查询/解锁", "纪念币预约/兑换信息查询", "纪念币库存登记薄查询", "全部导出查询下载", "名单数据查询", "反诈名单查询", "客户信息录入/修改", "客户信息管理", "客户信息查询", "客户风险评估", "强化尽职调查", "修改户名/证件登记簿查询", "客户信息待核实标识取消", "手机号码统一视图管理", "客户三要素修改", "手工同步信息", "一键绑卡", "查询引荐营销线索", "快签手活动", "综合开户", "行内存款", "行内取款", "介质迁移", "综合销户", "柜面他行卡取款", "绿卡通一本通定活互转", "个人大额存单开户", "个人大额存单子账户支取/销户", "大额存单产品信息查询", "一键签约", "一键解约", "一键平移", "一键查询", "新市民认证", "一键修改", "同步加办关系", "定期转定期", "综合销户（试点）", "账户激活", "行业应用子账户查询", "密码重置", "挂失及后续处理", "社保卡医保账户解挂失", "社保卡医保账户密码重置", "社保卡医保账户更改密印", "止付", "解止付", "冻结/解冻结", "扣划（司法）", "可疑凭证解锁定", "手工事项取款/销户", "开立定期存单质押业务证明书（存单止付）", "撤销定期存单质押业务证明书（存单解止付）", "来账状态查询", "免费账户查询", "代理人代理开户信息查询", "非实时转账撤销", "账户限制非柜面交易", "冲正", "取消", "现金汇款公司账户交易取消", "补登折/对账簿", "打印压缩明细", "随机换/折/单", "重新写磁", "加办密印", "更改密印", "撤销密印", "开立个人存款证明", "撤销个人存款证明", "个人存款证明登记簿查询和补打印", "账户升级/降级", "账户绑定关系设置", "I类账户批量降级", "账户绑定关系查询", "II类账户消费/缴费限额修改", "无介质II/III类账户身份确认", "账户加办关系查询与强制撤销", "强制销户", "非柜面限制交易解除", "一人多账户合理性原因登记", "多账户/多客户核实情况查询", "借记卡安全锁设置", "账户停用", "账户非柜面支付限额设置", "账户非柜面限额调整历史记录查询", "账户快捷支付限额设置", "自助交易设置", "自助设备可疑交易查询", "批量开定制卡", "批量处理结果查询", "批量开户未领介质对应关系查询", "批量开户", "批量文件编辑工具", "批量联网核查", "批量领介质", "可疑名单录入/删除", "可疑名单查询", "交易拦截查询功能", "开立个人养老金账户", "养老金账户缴存", "养老金账户支取", "养老金账户转移申请", "养老金账户转移取消", "养老金账户转移处理", "税延凭证打印", "养老金账户注销", "养老金账户激活/密码重置", "养老金账户缴存撤回", "账户风险等级人工评定", "账户回访任务处理", "存续期账户识别待办任务处理", "账户存续期识别情况统计表", "账户回访情况统计表", "个人账户评级白名单维护", "根据账号查短信加办关系", "交易日流水查询", "账户变动通知退费", "根据账号查账户变动通知历史变更记录", "开销户登记簿查询", "客户资料变更登记薄查询", "挂失登记簿查询", "司法止付/冻结登记簿", "止付解止付登记簿查询", "柜员差错交易登记簿查询", "同号换（补）卡登记簿查询", "扣划登记簿查询", "账户限制服务登记簿查询", "账户升降级登记簿查询", "客户业务办理情况查询", "新旧账（卡）号及归属地查询", "账务类交易流水查询", "根据账号/卡号查询非账务明细", "非账务类交易流水查询", "柜员末笔账务类交易查询", "报表查询打印", "收欠费明细查询", "柜员交易日志查询", "客户账户信息查询", "非实时转账查询", "电子现金账户明细查询", "查询账户基本信息", "查询账户明细", "系统退费明细查询", "定期账户转存明细查询", "跨境POS消费日累计系统限额查询", "副卡信息查询（客户、内部）", "副卡明细查询（客户、内部）", "人行小额支付系统代收付业务交易信息查询", "已故客户信息及明细信息", "一键账户查询", "司法查询", "批量司法查询结果下载", "电子现金卡退卡", "圈提", "同号换卡", "主卡撤销副卡", "副卡启用/停用", "换卡", "同号换（补）卡申请", "同号补卡", "同号/定制卡号凭证作废", "撤销折/对账簿", "卡撤销", "卡加办补发对账簿", "柜面他行卡查询", "吞没卡/废卡登记", "吞没卡/废卡领取", "吞没卡/废卡查询", "吞没卡/废卡上缴", "吞没卡/废卡上缴清单打印", "吞没卡/废卡登记簿查询", "绿卡通卡内约定转账定制", "绿卡通约定转账变更/撤销/查询", "电子银行账户强制撤销", "电子银行客户查询", "电子银行渠道关闭", "电子银行账户撤销", "电子银行认证工具变更", "电子银行认证工具换发", "电子银行UK证书补发", "电子银行密码重置", "手机银行设备绑定码申请", "电子银行信息同步/强制解约", "银联无卡支付签约信息查询", "钱包开立", "个人钱包销户", "数字货币兑回", "钱包基本信息查询", "钱包信息司法查询", "钱包交易明细司法查询", "钱包紧急止付解除", "钱包司法冻结", "汇款", "现金汇款公司账户", "预约账户汇款申请", "预约账户汇款修改/撤销", "预约账户汇款查询", "退汇挂账核销", "跨行汇款登记簿", "大小额往账交易明细查询", "跨行资金归集协议签约", "手机号收款账户管理", "按址取款通知单打印记录查询", "按址汇款短信发送查询/重发", "按址汇款", "密码汇款", "向商户号转账汇款", "汇票兑付", "通知单连续打印", "通知单补打", "投递清单浏览/打印", "汇兑凭证补打", "商户余额查询", "商务汇款清单查询", "收到商户资金", "商户收汇收据开发", "置妥前信息确认", "收据置妥", "汇票止付", "汇票详细信息查询", "接收专号查询", "特殊业务登记薄", "改汇", "取款通知单挂失", "撤销取款通知单挂失", "邮政汇兑短信服务", "客户申请退汇", "无法兑付退汇", "密码汇款密码挂失", "邮政汇兑密码重置", "收汇信息/附加业务更正", "汇款取消", "汇兑机构查询", "汇兑末笔流水查询", "信用卡现金存款", "信用卡现金转账还款", "信用卡账户转账还款", "信用卡取现", "信用卡转出转账", "信用卡账户余额查询", "信用卡账单头查询", "信用卡自动还款加办关系查询", "信用卡卡列表查询", "信用卡卡详细信息查询", "信用卡手机号码修改", "信用卡自动还款加办撤销", "信用卡激活", "信用卡交易密码重置", "信用卡小额免密免签功能设置", "新保承保", "我的投保单", "我的双录", "联机非实时保单录入", "联机非实时保单修改及取消", "保单信息查询", "代收业务三方协议管理", "交易代码查询", "理财类业务签约", "资金账号追加", "个人投资者客户资料查询", "个人合格投资者认定", "资金账号变更", "资金账号与身份证不一致变更", "特殊资金账号加办", "登记簿查询", "财产证明联动查询", "营业参数下载", "资产归并", "交易流水查询", "历史交易明细查询", "报表下载", "手续费参数查询", "理财类异常签约客户查询", "基金赎回", "网点代理基金品种查询", "理财产品购买（个人）", "理财产品赎回（个人）", "储蓄国债（凭证式）提前兑取（新）", "凭证国债取消购买交易", "凭证式国债出单", "凭证式国债收单", "储蓄国债（凭证式）挂失", "储蓄国债（凭证式）挂失补发", "储蓄国债(电子式)提前兑付", "个人当日/次日预约提金信息查询", "变更银行结算账号（个人）", "存管客户解约（个人）", "个人用户签约", "个人用户签约查询", "个人用户签约修改", "个人用户解约", "缴费", "发票/收据补打", "入账资金明细查询", "入账资金确认", "交易对手信息查询", "委托方签约信息查询", "优待证补换卡信息登记", "山东社保卡维护交易", "通用委托方信息查询", "业主开户", "文件加密密码申请", "缴费结果查询", "待查补录类", "任务汇总查询"];
        
        // DOM元素
        const videoElement = document.getElementById('video-preview');
        const scanFrame = document.getElementById('scan-frame');
        const statusText = document.getElementById('status-text');
        const loadingIndicator = document.getElementById('loading');
        const businessNameElement = document.getElementById('business-name');
        const businessCodeElement = document.getElementById('business-code');
        
        // 识别配置
        const config = {
            scanInterval: 1500, // 识别间隔（毫秒），1.5秒一次
            confidenceThreshold: 50, // 置信度阈值
            similarityThreshold: 0.7, // 字符串相似度阈值
            isRecognizing: false // 识别状态锁，防止并发
        };
        
        // 初始化Tesseract
        let tesseractWorker;
        let lastRecognizedText = '';
        let lastMatchedName = '';
        
        // 初始化摄像头
        async function initCamera() {
            try {
                statusText.textContent = '正在启动摄像头...';
                
                // 获取摄像头流
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment', // 使用后置摄像头
                        width: { ideal: window.innerWidth },
                        height: { ideal: window.innerHeight },
                        frameRate: { ideal: 10 } // 降低帧率，减少资源占用
                    }
                });
                
                videoElement.srcObject = stream;
                
                // 等待视频就绪
                await new Promise(resolve => {
                    videoElement.onloadedmetadata = resolve;
                });
                
                statusText.textContent = '摄像头已就绪，对准业务名称';
                loadingIndicator.style.display = 'none';
                
                // 初始化Tesseract
                initTesseract();
                
                // 开始循环识别
                setTimeout(startRecognitionLoop, config.scanInterval);
                
            } catch (error) {
                console.error('摄像头初始化失败:', error);
                statusText.textContent = '摄像头启动失败，请允许权限';
                businessNameElement.textContent = '错误: 无法访问摄像头';
                businessCodeElement.textContent = '请检查浏览器权限设置';
                loadingIndicator.style.display = 'none';
            }
        }
        
        // 初始化Tesseract OCR
        function initTesseract() {
            statusText.textContent = '正在加载识别引擎...';
            
            // 初始化Tesseract工作器
            tesseractWorker = Tesseract.createWorker({
                logger: m => {
                    // 可以在这里处理Tesseract的日志信息
                    if (m.status === 'loading tesseract core') {
                        statusText.textContent = '加载识别核心...';
                    } else if (m.status === 'loading language pack') {
                        statusText.textContent = '加载语言包...';
                    } else if (m.status === 'ready') {
                        statusText.textContent = '识别引擎就绪，对准业务名称';
                    }
                }
            });
            
            // 加载中文语言包
            (async () => {
                await tesseractWorker.load();
                await tesseractWorker.loadLanguage('chi_sim');
                await tesseractWorker.initialize('chi_sim');
                
                // 优化识别参数，提高速度和准确性
                await tesseractWorker.setParameters({
                    tessedit_char_whitelist: '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ甲乙丙丁戊己庚辛壬癸子丑寅卯辰巳午未申酉戌亥+-*/=（）【】、，。；：""''！？￥$%&@#¥',
                    preserve_interword_spaces: '0',
                    tessedit_pageseg_mode: Tesseract.PSM.SINGLE_LINE, // 单行识别模式
                    user_defined_dpi: 300
                });
            })();
        }
        
        // 图像识别处理
        async function recognizeFrame() {
            if (config.isRecognizing || !tesseractWorker) return;
            
            config.isRecognizing = true;
            
            try {
                // 获取识别区域的位置和尺寸
                const frameRect = scanFrame.getBoundingClientRect();
                const videoRect = videoElement.getBoundingClientRect();
                
                // 计算视频中的实际位置（考虑视频的缩放）
                const scaleX = videoElement.videoWidth / videoRect.width;
                const scaleY = videoElement.videoHeight / videoRect.height;
                
                const x = Math.max(0, Math.floor(frameRect.left * scaleX));
                const y = Math.max(0, Math.floor(frameRect.top * scaleY));
                const width = Math.min(videoElement.videoWidth - x, Math.floor(frameRect.width * scaleX));
                const height = Math.min(videoElement.videoHeight - y, Math.floor(frameRect.height * scaleY));
                
                // 创建画布用于截取图像
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                
                // 绘制视频帧的指定区域
                ctx.drawImage(
                    videoElement,
                    x, y, width, height,
                    0, 0, width, height
                );
                
                // 转换为灰度图像，提高识别速度
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    const gray = Math.floor((data[i] + data[i + 1] + data[i + 2]) / 3);
                    data[i] = gray;     // R
                    data[i + 1] = gray; // G
                    data[i + 2] = gray; // B
                }
                
                ctx.putImageData(imageData, 0, 0);
                
                // 进行OCR识别
                const { data: { text, confidence } } = await tesseractWorker.recognize(canvas);
                
                // 处理识别结果
                const cleanedText = cleanText(text);
                
                // 如果识别结果有变化，进行业务匹配
                if (cleanedText && cleanedText !== lastRecognizedText && confidence > config.confidenceThreshold) {
                    lastRecognizedText = cleanedText;
                    const { matchedName, businessCode } = findBestMatch(cleanedText);
                    
                    // 更新显示结果
                    if (matchedName && matchedName !== lastMatchedName) {
                        lastMatchedName = matchedName;
                        updateResultDisplay(matchedName, businessCode);
                    }
                }
                
            } catch (error) {
                console.error('识别错误:', error);
                // 不显示错误，避免影响用户体验
            } finally {
                config.isRecognizing = false;
            }
        }
        
        // 文本清理：去除多余空格和特殊字符
        function cleanText(text) {
            if (!text) return '';
            
            // 清理文本
            return text
                .replace(/\s+/g, '')          // 去除所有空格
                .replace(/[\n\r\t]/g, '')  // 去除换行符和制表符
                .replace(/[\u2000-\u206F]/g, '') // 去除特殊空格
                .replace(/[\u3000]/g, '')     // 去除全角空格
                .trim();
        }
        
        // 查找最匹配的业务名称（使用相似度算法）
        function findBestMatch(recognizedText) {
            let bestMatch = '';
            let bestCode = '';
            let highestSimilarity = 0;
            
            // 遍历所有业务名称，计算相似度
            for (const name of businessNames) {
                // 简单的包含匹配（快速筛选）
                if (name.includes(recognizedText) || recognizedText.includes(name)) {
                    const similarity = calculateSimilarity(name, recognizedText);
                    
                    if (similarity > highestSimilarity && similarity > config.similarityThreshold) {
                        highestSimilarity = similarity;
                        bestMatch = name;
                        bestCode = businessData[name] || '';
                    }
                }
            }
            
            return {
                matchedName: bestMatch,
                businessCode: bestCode
            };
        }
        
        // 计算字符串相似度（简化版Levenshtein距离）
        function calculateSimilarity(str1, str2) {
            if (str1 === str2) return 1.0;
            
            const len1 = str1.length;
            const len2 = str2.length;
            const maxLen = Math.max(len1, len2);
            
            if (maxLen === 0) return 1.0;
            
            // 计算匹配的字符数
            let matches = 0;
            const minLen = Math.min(len1, len2);
            
            for (let i = 0; i < minLen; i++) {
                if (str1[i] === str2[i]) {
                    matches++;
                }
            }
            
            // 计算包含关系的额外分数
            let containsBonus = 0;
            if (str1.includes(str2) || str2.includes(str1)) {
                containsBonus = 0.2;
            }
            
            // 计算相似度（0-1之间）
            const baseSimilarity = matches / maxLen;
            return Math.min(1.0, baseSimilarity + containsBonus);
        }
        
        // 更新结果显示
        function updateResultDisplay(name, code) {
            if (name && code) {
                // 平滑更新文本
                businessNameElement.style.transition = 'all 0.3s ease';
                businessCodeElement.style.transition = 'all 0.3s ease';
                
                businessNameElement.style.opacity = '0';
                businessCodeElement.style.opacity = '0';
                
                setTimeout(() => {
                    businessNameElement.textContent = name;
                    businessCodeElement.textContent = `业务编号: ${code}`;
                    businessNameElement.style.opacity = '1';
                    businessCodeElement.style.opacity = '1';
                }, 300);
                
                // 识别成功的视觉反馈
                scanFrame.style.borderColor = '#4CAF50';
                scanFrame.style.boxShadow = '0 0 25px rgba(76, 175, 80, 1)';
                
                setTimeout(() => {
                    scanFrame.style.borderColor = '#4CAF50';
                    scanFrame.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.8)';
                }, 1000);
                
            } else {
                // 没有匹配结果
                businessNameElement.textContent = '未识别到业务名称';
                businessCodeElement.textContent = '请调整位置或光线';
                
                scanFrame.style.borderColor = '#FF5252';
                scanFrame.style.boxShadow = '0 0 20px rgba(255, 82, 82, 0.8)';
            }
        }
        
        // 识别循环
        function startRecognitionLoop() {
            recognizeFrame();
            setTimeout(startRecognitionLoop, config.scanInterval);
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            // 检查浏览器支持
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                statusText.textContent = '浏览器不支持摄像头功能';
                businessNameElement.textContent = '错误: 浏览器不支持';
                businessCodeElement.textContent = '请使用最新版Edge浏览器';
                loadingIndicator.style.display = 'none';
                return;
            }
            
            // 初始化摄像头
            initCamera();
            
            // 窗口大小变化时调整
            window.addEventListener('resize', () => {
                // 重新计算识别框位置
                const frameRect = scanFrame.getBoundingClientRect();
                scanFrame.style.top = '50%';
                scanFrame.style.marginTop = '-30px';
            });
        });
    </script>
</body>
</html>